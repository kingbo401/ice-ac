<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper 
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kingbo401.iceacl.dao.PermissionGroupDAO">
	<insert id="create" parameterType="PermissionGroupDO"
		useGeneratedKeys="true" keyProperty="id">
		insert into ice_permission_group (app_key,tenant,group_type,tag1,group_pid,
		group_name, description, group_order, status, create_time, update_time)
		values (#{appKey}, #{tenant},#{groupType},#{tag1}, #{groupPid}, #{groupName},
		#{description}, #{groupOrder}, #{status}, #{createTime},#{updateTime}
		)
	</insert>

	<update id="update" parameterType="PermissionGroupDO">
		update ice_permission_group
		<set>
			<if test="groupName != null">
				group_name = #{groupName},
			</if>
			<if test="groupType != null">
				group_type = #{groupType},
			</if>
			<if test="tag1 != null">
				tag1 = #{tag1},
			</if>
			<if test="description != null">
				description = #{description},
			</if>
			<if test="groupOrder != null">
				group_order = #{groupOrder},
			</if>
			<if test="status != null">
				status = #{status},
			</if>
			update_time = #{updateTime}
		</set>
		where id = #{id}
	</update>

	<select id="getByIds" resultType="PermissionGroupDO">
		select * from ice_permission_group where status = 1 and id in
		<foreach collection="ids" item="id" open="(" close=")"
			separator=",">
			#{id}
		</foreach>
	</select>

	<select id="getById" resultType="PermissionGroupDO">
		select * from ice_permission_group where status != 0 and id = #{id}
	</select>
	
 	<select id="listPermissionGroupLite" resultType="PermissionGroupLite" >
    	select id, group_pid from ice_permission_group where app_key=#{appKey} and tenant = #{tenant}
    </select>
    
    <sql id="queryPermissionGroupSubSql">
		where status != 0 and app_key = #{appKey}
		<if test='tenant == "tenant_common_symbol"'>
		    and tenant='tenant_common_symbol'
		</if>
		<if test='tenant != "tenant_common_symbol"'>
		    and tenant in ('tenant_common_symbol',#{tenant})
		</if>
		<if test="groupType != null and groupType != ''">
			and group_type = #{groupType}
		</if>
		<if test="tag1 != null and tag1 != ''">
			and tag1 = #{tag1}
		</if>
		<if test="groupName != null and groupName != ''">
			and group_name like concat('%', #{groupName}, '%')
		</if>
		<if test="groupPid != null">
			and group_pid = #{groupPid}
		</if>
	</sql>
    
    
	<select id="listPermissionGroup" resultType="PermissionGroupDO"
		parameterType="PermissionGroupQueryParam">
		select * from ice_permission_group
		<include refid="queryPermissionGroupSubSql" />
		<if test = "orderField != null and orderField != ''">
		    order by ${orderField} ${orderType}
		</if>
	</select>

	<select id="pagePermissionGroup" resultType="PermissionGroupDO"
		parameterType="PermissionGroupQueryParam">
		select * from ice_permission_group 
		<include refid="queryPermissionGroupSubSql" />
		<if test = "orderField != null and orderField != ''">
		    order by ${orderField} ${orderType}
		</if>
		limit #{offset},#{pageSize}
	</select>

	<select id="countPermissionGroup" resultType="long"
		parameterType="PermissionGroupQueryParam">
		select count(*) from ice_permission_group 
		<include refid="queryPermissionGroupSubSql" />
	</select>
</mapper>