<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper 
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.kingbo401.iceacl.dao.RoleDAO">
	<insert id="createRole" parameterType="RolePO" useGeneratedKeys="true" keyProperty="id">
		insert into ice_role (app_key,role_key,role_name,role_type,level,description,tenant,
		tag1,status,create_time, update_time)
		values (#{appKey},#{roleKey},#{roleName},#{roleType},#{level},#{description},#{tenant},
		#{tag1},,#{status},#{createTime},#{updateTime})
		ON DUPLICATE KEY update status=#{status},role_name=#{roleName},role_type=#{roleType},
		level=#{level},description=#{description},tenant=#{tenant},tag1=#{tag1},update_time = now()
	</insert>
	
	<update id="updateRole" parameterType="RolePO" useGeneratedKeys="true" keyProperty="id">
		update ice_role 
		<set >
			<if test="roleName != null" >
				role_name = #{roleName},
			</if>
			<if test="description != null" >
				description = #{description},
			</if>
			<if test="roleType != null">
				role_type = #{roleType},
			</if>
			<if test="tag1 != null">
				tag1 = #{tag1},
			</if>
			<if test="status != null" >
				status = #{status},
			</if>
			<if test="level != null" >
				level = #{level},
			</if>
			update_time = #{updateTime}
		</set>
		where id=#{id}
	</update>
	
    <select id="getRoleByKey" resultType="RolePO">
		select * from ice_role where app_key=#{appKey} and role_key=#{roleKey} and status != 0
	</select>
	
	<select id="getRoleById" resultType="RolePO">
		select * from ice_role where id=#{id} and status != 0
	</select>
	
	<sql id="queryRoleSubSql">
		 where app_key = #{appKey} and status != 0
		<if test='tenant == "tenant_common_symbol"'>
		    and tenant='tenant_common_symbol'
		</if>
		<if test='tenant != "tenant_common_symbol"'>
		    and tenant in ('tenant_common_symbol',#{tenant})
		</if>
		 <if test="roleType != null and roleType !=''">
			and role_type = #{roleType}
		</if>
		<if test="tag1 != null and tag1 !=''">
			and tag1 = #{tag1}
		</if>
		<if test="roleId != null">
			and role_id = #{roleId}
		</if>
		<if test="roleKey != null and roleKey !=''">
			and role_key = #{roleKey}
		</if>
		<if test="roleName != null and roleName != ''">
			and role_name like  concat('%', #{roleName}, '%')
		</if>
		<if test="status != null">
			and status = #{status}
		</if>
		<if test="levelEq != null">
			and level = #{levelEq}
		</if>
		<if test="levelGe != null">
			and level &gt;= #{levelGe}
		</if>
		<if test="levelEq != null">
			and level &lt;= #{levelEq}
		</if>
	</sql>
	
	<select id="pageRole" parameterType="RoleQueryParam" resultType="RolePO">
		select * from ice_role 
		<include refid="queryPermissionSubSql" />
		<if test = "orderField != null and orderField != ''">
	       order by ${orderField} ${orderType}
	    </if>
		limit #{offset},#{pageSize}
	</select>
	
	<select id="listRole"  parameterType="RoleQueryParam" resultType="RolePO">
		select * from ice_role
		<include refid="queryPermissionSubSql" />
		<if test = "orderField != null and orderField != ''">
	       order by ${orderField} ${orderType}
	    </if>
	</select>
	
	<select id="countRole" parameterType="RoleQueryParam" resultType="long">
		select count(*) from ice_role
		<include refid="queryPermissionSubSql" />
	</select>

	<select id="getRoleByIds" resultType="RolePO">
		select * from ice_role where status != 0 and id in
		 <foreach collection="ids" open="(" close=")" separator="," item="id">
			 #{id}
		 </foreach>
	</select>
	
	<select id="getRoleByKeys" resultType="RolePO">
		select * from ice_role where status != 0 and app_key=#{appKey} and role_key in
		 <foreach collection="roleKeys" open="(" close=")" separator="," item="roleKey">
			 #{roleKey}
		 </foreach>
	</select>
</mapper>